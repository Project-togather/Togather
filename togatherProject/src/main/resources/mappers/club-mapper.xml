<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "mybatis-3-mapper.dtd" >
<mapper namespace="clubMapper">

	<resultMap type="Club" id="resultclub">
		<result column="c_no" property="classNo"/>
		<result column="mem_no" property="memNo"/>
		<result column="c_title" property="classTitle"/>
		<result column="c_content" property="classContent"/>
		<result column="c_location" property="classLocation"/>
		<result column="c_date" property="classDate"/>
		<result column="c_time" property="classTime"/>
		<result column="c_price" property="classPrice"/>
		<result column="c_approval" property="classApproval"/>
		<result column="minage" property="minAge"/>
		<result column="maxage" property="maxAge"/>
		<result column="people_limit" property="peopleLimit"/>
		<result column="vacancy" property="vacancy"/>
		<result column="nickname" property="nickname"/>
		<result column="cl_type" property="clType"/>
		<result column="cl_category" property="clCategory"/>
		<result column="cl_name" property="clName"/>
		<result column="curriculum" property="curriculum"/>
		<result column="status" property="status"/>
	
		<collection property="attachment" resultMap="attachment"/>
	</resultMap>
	
	<resultMap type="Attachment" id="attachment">
		<result column="origin_name" property="originName"/>
		<result column="update_name" property="updateName"/>
		<result column="file_path" property="filePath"/>
	</resultMap>
	
	<select id="selectClassList" resultMap="resultclub">
        select 
		       c_no
		     , mem_no
		     , c_title
		     , c_content
		     , c_location
		     , c_date
             , c_time
		     , c_price
		     , c_approval
		     , minage
             , maxage
		     , people_limit
             , cl_type
		     , cl_category
		     , curriculum
		     , origin_name
		     , update_name
		     , file_path
		  from class
		  join attachment on (c_no = ref_fno)
		 where status = 'Y'
	</select>
	
	<select id="selectSocialList" resultMap="resultclub">
        select 
		       c_no
		     , mem_no
		     , c_title
		     , c_content
		     , c_location
		     , c_date
             , c_time
		     , c_price
		     , c_approval
		     , minage
             , maxage
		     , people_limit
             , cl_type
		     , cl_category
		     , curriculum
		     , origin_name
		     , update_name
		     , file_path
		  from class
		  join attachment on (c_no = ref_fno)
		 where status = 'Y'
		   and cl_type = 1
	</select>
	
		<select id="selectClubList" resultMap="resultclub">
        select 
		       c_no
		     , mem_no
		     , c_title
		     , c_content
		     , c_location
		     , c_date
             , c_time
		     , c_price
		     , c_approval
		     , minage
             , maxage
		     , people_limit
             , cl_type
		     , cl_category
		     , curriculum
		     , origin_name
		     , update_name
		     , file_path
		  from class
		  join attachment on (c_no = ref_fno)
		 where status = 'Y'
		   and cl_type = 2
	</select>
	
		<select id="selectChallengeList" resultMap="resultclub">
        select 
		       c_no
		     , mem_no
		     , c_title
		     , c_content
		     , c_location
		     , c_date
             , c_time
		     , c_price
		     , c_approval
		     , minage
             , maxage
		     , people_limit
             , cl_type
		     , cl_category
		     , curriculum
		     , origin_name
		     , update_name
		     , file_path
		  from class
		  join attachment on (c_no = ref_fno)
		 where status = 'Y'
		   and cl_type = 3
	</select>
	
		<select id="selectOneDayList" resultMap="resultclub">
        select 
		       c_no
		     , mem_no
		     , c_title
		     , c_content
		     , c_location
		     , c_date
             , c_time
		     , c_price
		     , c_approval
		     , minage
             , maxage
		     , people_limit
             , cl_type
		     , cl_category
		     , curriculum
		     , origin_name
		     , update_name
		     , file_path
		  from class
		  join attachment on (c_no = ref_fno)
		 where status = 'Y'
		   and cl_type = 4
	</select>
	
	<select id="selectClassDetail" resultMap="resultclub">
		select
		       c_no
		     , mem_no
		     , c_title
		     , c_content
		     , c_location
		     , to_char(to_date(c_date), 'yyyy-mm-dd dy') c_date
		     , c_time
		     , to_char(c_price, 'FM999,999') c_price
		     , c_approval
		     , minage
		     , maxage
		     , people_limit
		     , cl_type
		     , cl_category
		     , cl_name
		     , curriculum
		     , status
		     , nickname
		     , people_limit - (select count(*)
		                         from my_class
		                        where c_no = 'C'||#{classNo}) vacancy
		  from class
		  join member using (mem_no)
		  join cl_category on (cl_category = cl_categoryno)
		 where c_no = 'C'||#{classNo}
		   and status = 'Y'
	</select>
	

	<insert id="insertClass">
		insert 
		  into Class	
			 (
				c_no
			  , mem_no
			  , c_title
			  , c_content
			  , c_location
			  , c_date
			  , c_time
			  , c_price
			  , c_approval
			  , minage
			  , maxage
			  , people_limit
			  , cl_type
			  , cl_category
			  , curriculum
			 )
		values
			 (
			    'C'||seq_cno.nextval
			  , #{memNo}
			  , #{classTitle}
			  , #{classContent}
			  , #{classLocation}
			  , #{classDate}
			  , #{classTime}
			  , #{classPrice}
			  , #{classApproval}
			  , #{minAge}
			  , #{maxAge}
			  , #{peopleLimit}
			  , #{clType}
			  , #{clCategory}
			  , #{curriculum}
			 )
	</insert>
	
	<insert id="insertImg">
		insert 
		  into attachment	
			 (
			    att_no
			   ,ref_fno
			   ,origin_name
			   ,update_name
			   ,file_path
			   ,enroll_date
			   ,category
			 )
		values
			 (
			    'A'||seq_ano.nextval
			   ,'C'||seq_cno.currval
			   , #{originName}
			   , #{updateName}
			   , #{filePath}
			   , sysdate
			   , #{category}
			 )
	</insert>

	<select id="selectSocialingListCount" resultType="_int">
		select
		count(*)
	from class
	where status = 'Y'
	</select>
	
	<select id="selectSocialingList" resultMap="resultclub">
		select
	        c_no
	    ,   c_title
	    ,   c_location
	    ,   c_date
	    from class
	    where status = 'Y'
	    order by c_no desc
	</select>

	<insert id="insertReply">
		insert
		  into reply
		  values
		  (
		  	'RE'||seq_reno.nextval
		  , #{rvContent}
		  , sysdate
		  , 'Y'
		  , #{refFno}	
		  , #{memNo}
		  )
	</insert>
	

</mapper>